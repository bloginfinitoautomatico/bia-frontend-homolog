<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Teste de API OpenAI - BIA</title>
    <style>
        body { 
            font-family: 'Montserrat', Arial, sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px; 
            background: #f5f5f5; 
        }
        .card { 
            background: white; 
            padding: 20px; 
            margin: 20px 0; 
            border-radius: 8px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
        }
        .status { 
            padding: 8px 12px; 
            border-radius: 4px; 
            font-weight: bold; 
            margin: 10px 0; 
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .info { background: #d1ecf1; color: #0c5460; }
        .button { 
            background: #8c52ff; 
            color: white; 
            padding: 10px 20px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            margin: 5px; 
        }
        .button:hover { background: #7a47e6; }
        #result { 
            background: #f8f9fa; 
            padding: 15px; 
            border-radius: 4px; 
            margin: 10px 0; 
            min-height: 100px; 
            max-height: 400px; 
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>üîß Teste de Corre√ß√£o da API OpenAI</h1>
    
    <div class="card">
        <h2>üìã Problema Identificado</h2>
        <div class="status error">
            ‚ùå Erro 401: API key do OpenAI inv√°lida ou expirada
        </div>
        <p><strong>Erro original:</strong> <code>Failed to load resource: the server responded with a status of 401</code></p>
    </div>

    <div class="card">
        <h2>üîß Corre√ß√£o Aplicada</h2>
        <div class="status success">
            ‚úÖ Chave API atualizada no frontend (.env)
        </div>
        <ul>
            <li>‚úÖ Identificada chave v√°lida no backend</li>
            <li>‚úÖ Atualizada vari√°vel VITE_OPENAI_API_KEY</li>
            <li>‚úÖ Servidor frontend reiniciado automaticamente</li>
        </ul>
    </div>

    <div class="card">
        <h2>üß™ Teste da API</h2>
        <p>Clique no bot√£o abaixo para testar se a API do OpenAI est√° funcionando:</p>
        <button class="button" onclick="testAPI()">üöÄ Testar API OpenAI</button>
        <div id="result"></div>
    </div>

    <div class="card">
        <h2>üìù Como Testar a Produ√ß√£o de Artigos</h2>
        <ol>
            <li>Acesse: <a href="http://localhost:5174/#produzir" target="_blank">http://localhost:5174/#produzir</a></li>
            <li>Clique em "Adicionar Nova Ideia"</li>
            <li>Preencha:
                <ul>
                    <li><strong>T√≠tulo:</strong> Teste de API OpenAI</li>
                    <li><strong>Categoria:</strong> Tecnologia</li>
                    <li><strong>Site:</strong> Qualquer site dispon√≠vel</li>
                </ul>
            </li>
            <li>Clique em "Produzir" ao lado da ideia</li>
            <li>Aguarde a gera√ß√£o (pode demorar 1-2 minutos)</li>
        </ol>
    </div>

    <div class="card">
        <h2>üîë Informa√ß√µes T√©cnicas</h2>
        <div class="status info">
            <strong>Chave Anterior (inv√°lida):</strong><br>
            <code>sk-proj-xfqP-bBjJxFGCz9n1Bge1HA2...</code>
        </div>
        <div class="status success">
            <strong>Chave Atual (v√°lida):</strong><br>
            <code>sk-proj-UijtJz6zrkQ7q60C2M3Y...</code>
        </div>
        <p><small>üí° A chave foi sincronizada com a configura√ß√£o do backend</small></p>
    </div>

    <script>
        async function testAPI() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<div class="status warning">‚è≥ Testando conex√£o com OpenAI...</div>';
            
            try {
                // Simular o teste que o sistema far√°
                const response = await fetch('https://api.openai.com/v1/models', {
                    headers: {
                        'Authorization': 'Bearer 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',
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    const modelCount = data.data ? data.data.length : 0;
                    
                    resultDiv.innerHTML = `
                        <div class="status success">
                            ‚úÖ <strong>API OpenAI funcionando!</strong><br>
                            üìä ${modelCount} modelos dispon√≠veis<br>
                            üéØ Status: ${response.status} - OK
                        </div>
                        <p><strong>Pr√≥ximo passo:</strong> Teste a produ√ß√£o de artigos na p√°gina principal.</p>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="status error">
                            ‚ùå <strong>Erro ${response.status}</strong><br>
                            A API ainda n√£o est√° funcionando corretamente.
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="status error">
                        ‚ùå <strong>Erro de conex√£o:</strong><br>
                        ${error.message}<br><br>
                        <small>üí° Isso pode ser normal devido ao CORS. Teste diretamente na aplica√ß√£o.</small>
                    </div>
                `;
            }
        }

        // Teste autom√°tico ao carregar
        window.addEventListener('load', function() {
            console.log('üîß P√°gina de teste da API OpenAI carregada');
            console.log('üí° Chave API atualizada e servidor reiniciado');
        });
    </script>
</body>
</html>
